<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musical Scales Reference - Music Machine</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/tonal@5.0.0/browser/tonal.min.js"></script>
    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <script src="js/guitar-audio.js"></script>
    <style>
        .scales-page {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            background: var(--background-color);
            color: var(--text-primary);
        }

        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
            text-shadow: var(--glow-accent);
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .navigation {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .nav-link {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-color);
            color: var(--secondary-color);
            text-decoration: none;
            border-radius: var(--border-radius);
            margin: 0 var(--spacing-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: var(--secondary-color);
            color: var(--background-color);
            box-shadow: var(--glow-secondary);
        }

        .filter-controls {
            background: var(--surface-elevated);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            border: 1px solid var(--border-color);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .filter-group label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: var(--font-size-base);
        }

        .filter-select {
            padding: var(--spacing-sm);
            background: var(--surface-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: var(--glow-secondary);
        }

        .scale-section {
            margin-bottom: var(--spacing-2xl);
            background: var(--surface-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
        }

        .scale-section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .scale-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .scale-card {
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }

        .scale-card:hover {
            border-color: var(--secondary-color);
            box-shadow: var(--glow-secondary);
        }

        .scale-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
        }

        .scale-info {
            margin-bottom: var(--spacing-md);
        }

        .scale-notes {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .note {
            background: var(--primary-color);
            color: var(--background-color);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: var(--font-family-mono);
        }

        .scale-pattern {
            font-family: var(--font-family-mono);
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: var(--spacing-sm);
        }

        .scale-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: var(--spacing-sm);
        }

        .scale-audio-controls {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .play-scale-btn {
            background: var(--secondary-color);
            color: var(--background-color);
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .play-scale-btn:hover {
            background: var(--primary-color);
            box-shadow: var(--glow-primary);
        }

        .play-scale-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .scale-card.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
            background: var(--surface-color);
        }

        .fretboard-display {
            background: var(--surface-elevated);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
            border: 1px solid var(--border-color);
            display: none;
        }

        .fretboard-display.active {
            display: block;
        }

        .fretboard-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-subtle);
        }

        .fretboard-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--spacing-sm);
        }

        .fretboard-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .fretboard-container {
            display: flex;
            justify-content: center;
            margin: var(--spacing-lg) 0;
            overflow-x: auto;
            padding: var(--spacing-md);
        }

        .guitar-fretboard {
            position: relative;
            background: linear-gradient(to right, #8B4513 0%, #D2691E 5%, #CD853F 95%, #8B4513 100%);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg) var(--spacing-md);
            min-width: 900px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .fretboard-strings-container {
            position: relative;
            height: 240px;
        }

        .string-labels {
            position: absolute;
            left: -50px;
            top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0;
        }

        .string-label {
            background: var(--surface-elevated);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.8rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-subtle);
            padding: 4px 8px;
            min-width: 30px;
            text-align: center;
        }

        .guitar-string {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, #C0C0C0, #E8E8E8, #C0C0C0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .guitar-string:nth-child(1) { top: 180px; height: 3.5px; } /* Low E - Bottom */
        .guitar-string:nth-child(2) { top: 148px; height: 3px; }   /* A */
        .guitar-string:nth-child(3) { top: 116px; height: 2.5px; } /* D */
        .guitar-string:nth-child(4) { top: 84px; height: 2px; }    /* G */
        .guitar-string:nth-child(5) { top: 52px; height: 1.5px; }  /* B */
        .guitar-string:nth-child(6) { top: 20px; height: 1px; }    /* High E - Top */

        .fret-wire {
            position: absolute;
            top: 10px;
            bottom: 10px;
            width: 3px;
            background: linear-gradient(to bottom, #FFD700, #FFA500, #FFD700);
            box-shadow: 1px 0 3px rgba(0, 0, 0, 0.4), -1px 0 3px rgba(0, 0, 0, 0.4);
            border-radius: 1px;
        }

        .fret-wire.nut {
            width: 4px;
            background: linear-gradient(to bottom, #F5F5DC, #DDBF8C, #F5F5DC);
            left: 0;
        }

        .fret-numbers {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
        }

        .fret-number {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-align: center;
            position: absolute;
        }

        .fret-markers {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            height: 10px;
        }

        .fret-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 5px rgba(255, 217, 61, 0.5);
        }

        .fret-marker.double {
            height: 6px;
            width: 6px;
        }

        .fret-marker.double:after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--accent-color);
            border-radius: 50%;
            top: -12px;
            left: 0;
            box-shadow: 0 0 5px rgba(255, 217, 61, 0.5);
        }

        .note-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            max-width: 24px;
            max-height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            transform: translate(-50%, -50%);
            border: 2px solid transparent;
            box-sizing: border-box;
        }

        .note-marker:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .note-marker.scale-note {
            background: var(--primary-color);
            color: var(--background-color);
            border-color: var(--primary-color);
            box-shadow: 0 2px 12px rgba(255, 107, 107, 0.6);
        }

        .note-marker.root-note {
            background: var(--accent-color);
            color: var(--background-color);
            border-color: var(--accent-color);
            box-shadow: 0 2px 12px rgba(255, 217, 61, 0.6);
            animation: rootPulse 2s ease-in-out infinite;
        }

        @keyframes rootPulse {
            0%, 100% { box-shadow: 0 2px 12px rgba(255, 217, 61, 0.6); }
            50% { box-shadow: 0 2px 20px rgba(255, 217, 61, 0.8); }
        }

        .note-marker.playing {
            animation: notePlaying 0.6s ease-in-out;
            transform: translate(-50%, -50%) scale(1.3);
            z-index: 10;
        }

        @keyframes notePlaying {
            0% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 2px 12px rgba(255, 255, 255, 0.6);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.4);
                box-shadow: 0 4px 20px rgba(255, 255, 255, 0.9);
            }
            100% {
                transform: translate(-50%, -50%) scale(1.3);
                box-shadow: 0 2px 16px rgba(255, 255, 255, 0.7);
            }
        }

        .note-marker.clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .note-marker.clickable:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 2px 16px rgba(255, 255, 255, 0.5);
        }

        .play-scale-btn {
            font-weight: 600;
            background: var(--accent-color) !important;
            color: var(--background-color) !important;
            border-color: var(--accent-color) !important;
        }

        .play-scale-btn:hover {
            background: var(--secondary-color) !important;
            border-color: var(--secondary-color) !important;
        }

        .play-scale-btn.playing {
            background: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .fretboard-legend {
            display: flex;
            justify-content: center;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 0.8rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .fretboard-controls {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .fretboard-btn {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .fretboard-btn:hover {
            background: var(--secondary-color);
            color: var(--background-color);
        }

        .fretboard-btn.active {
            background: var(--primary-color);
            color: var(--background-color);
            border-color: var(--primary-color);
        }

        .stats-section {
            background: var(--surface-elevated);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            border: 1px solid var(--border-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-subtle);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary-color);
            display: block;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: var(--spacing-xs);
        }

        @media (max-width: 768px) {
            .scale-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="scales-page">
        <div class="page-header">
            <h1 class="page-title">🎵 Musical Scales Reference</h1>
            <p class="page-subtitle">Comprehensive database of musical scales with notes, patterns, and audio examples</p>
        </div>

        <div class="navigation">
            <a href="index.html" class="nav-link">← Back to Music Machine</a>
            <a href="chords.html" class="nav-link">🎸 Chords</a>
            <a href="#stats" class="nav-link">📊 Statistics</a>
        </div>

        <div class="filter-controls">
            <h3>🔍 Filter Scales</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="root-filter">Root Note</label>
                    <select id="root-filter" class="filter-select">
                        <option value="all">All Notes</option>
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="scale-type-filter">Scale Type</label>
                    <select id="scale-type-filter" class="filter-select">
                        <option value="all">All Scale Types</option>
                        <option value="major">Major Scales</option>
                        <option value="minor">Minor Scales</option>
                        <option value="mode">Modal Scales</option>
                        <option value="pentatonic">Pentatonic Scales</option>
                        <option value="blues">Blues Scales</option>
                        <option value="exotic">Exotic Scales</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="mood-filter">Mood/Character</label>
                    <select id="mood-filter" class="filter-select">
                        <option value="all">All Moods</option>
                        <option value="happy">Happy/Bright</option>
                        <option value="sad">Sad/Dark</option>
                        <option value="mysterious">Mysterious</option>
                        <option value="exotic">Exotic/World</option>
                        <option value="jazzy">Jazzy/Sophisticated</option>
                        <option value="bluesy">Bluesy/Soulful</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="stats" class="stats-section">
            <h2>📊 Scale Database Statistics</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number" id="total-scales">0</span>
                    <div class="stat-label">Total Scales</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="major-scales">0</span>
                    <div class="stat-label">Major Scales</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="minor-scales">0</span>
                    <div class="stat-label">Minor Scales</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="modal-scales">0</span>
                    <div class="stat-label">Modal Scales</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="pentatonic-scales">0</span>
                    <div class="stat-label">Pentatonic Scales</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="exotic-scales">0</span>
                    <div class="stat-label">Exotic Scales</div>
                </div>
            </div>
        </div>

        <div id="fretboard-display" class="fretboard-display">
            <div class="fretboard-header">
                <h2 class="fretboard-title" id="fretboard-title">Select a scale to view on fretboard</h2>
                <p class="fretboard-subtitle" id="fretboard-subtitle">Click any scale card below to see all scale notes mapped across the guitar neck</p>
            </div>

            <div class="fretboard-controls">
                <button class="fretboard-btn active" onclick="setFretboardRange(0, 12)">Standard View (0-12)</button>
                <button class="fretboard-btn" onclick="setFretboardRange(0, 24)">Extended View (0-24)</button>
                <button class="fretboard-btn" onclick="setFretboardRange(3, 15)">Upper Register (3-15)</button>
                <button class="fretboard-btn" onclick="toggleNoteLabels()">Toggle Note Names</button>
                <button class="fretboard-btn play-scale-btn" onclick="playScale()" id="play-scale-btn">▶️ Play Scale</button>
            </div>

            <div class="fretboard-container">
                <div id="guitar-fretboard" class="guitar-fretboard">
                    <!-- Fretboard will be generated here -->
                </div>
            </div>

            <div class="fretboard-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--accent-color); color: var(--background-color); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.6rem;">R</div>
                    <span>Root Note</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--primary-color);"></div>
                    <span>Scale Notes</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: var(--background-color); border: 1px solid var(--border-color);"></div>
                    <span>Other Notes</span>
                </div>
            </div>
        </div>

        <div id="scales-container">
            <!-- Scale sections will be generated here -->
        </div>
    </div>

    <script type="module">
        // Musical scales database with comprehensive information
        const scaleDatabase = {
            // Major Scale Family
            'major': {
                pattern: [2, 2, 1, 2, 2, 2, 1],
                description: 'The foundational scale of Western music. Bright, happy, and optimistic.',
                category: 'major',
                mood: 'happy',
                aliases: ['ionian']
            },
            'natural minor': {
                pattern: [2, 1, 2, 2, 1, 2, 2],
                description: 'The most common minor scale. Sad, melancholic, and emotional.',
                category: 'minor',
                mood: 'sad',
                aliases: ['aeolian', 'minor']
            },
            'harmonic minor': {
                pattern: [2, 1, 2, 2, 1, 3, 1],
                description: 'Minor scale with raised 7th degree. Creates exotic, classical sound.',
                category: 'minor',
                mood: 'mysterious'
            },
            'melodic minor': {
                pattern: [2, 1, 2, 2, 2, 2, 1],
                description: 'Minor scale with raised 6th and 7th degrees. Jazz and classical favorite.',
                category: 'minor',
                mood: 'jazzy'
            },

            // Modal Scales
            'dorian': {
                pattern: [2, 1, 2, 2, 2, 1, 2],
                description: 'Minor mode with raised 6th. Celtic, folk, and jazz applications.',
                category: 'mode',
                mood: 'mysterious'
            },
            'phrygian': {
                pattern: [1, 2, 2, 2, 1, 2, 2],
                description: 'Dark minor mode with flat 2nd. Spanish and metal music.',
                category: 'mode',
                mood: 'exotic'
            },
            'lydian': {
                pattern: [2, 2, 2, 1, 2, 2, 1],
                description: 'Major mode with raised 4th. Dreamy, floating sound.',
                category: 'mode',
                mood: 'happy'
            },
            'mixolydian': {
                pattern: [2, 2, 1, 2, 2, 1, 2],
                description: 'Major mode with flat 7th. Rock, blues, and Celtic music.',
                category: 'mode',
                mood: 'bluesy'
            },
            'locrian': {
                pattern: [1, 2, 2, 1, 2, 2, 2],
                description: 'Diminished mode. Unstable, theoretical, rarely used.',
                category: 'mode',
                mood: 'mysterious'
            },

            // Pentatonic Scales
            'major pentatonic': {
                pattern: [2, 2, 3, 2, 3],
                description: 'Five-note major scale. Simple, folk-like, universally pleasant.',
                category: 'pentatonic',
                mood: 'happy'
            },
            'minor pentatonic': {
                pattern: [3, 2, 2, 3, 2],
                description: 'Five-note minor scale. Blues, rock, and world music staple.',
                category: 'pentatonic',
                mood: 'bluesy'
            },

            // Blues Scales
            'blues': {
                pattern: [3, 2, 1, 1, 3, 2],
                description: 'Minor pentatonic with added flat 5th. Core of blues and rock.',
                category: 'blues',
                mood: 'bluesy'
            },
            'major blues': {
                pattern: [2, 1, 1, 3, 2, 3],
                description: 'Major pentatonic with added flat 3rd. Bluesy but brighter.',
                category: 'blues',
                mood: 'bluesy'
            },

            // Exotic and World Scales
            'hungarian minor': {
                pattern: [2, 1, 3, 1, 1, 3, 1],
                description: 'Dramatic Eastern European scale with two augmented 2nds.',
                category: 'exotic',
                mood: 'exotic'
            },
            'arabic': {
                pattern: [1, 3, 1, 2, 1, 3, 1],
                description: 'Middle Eastern scale with quarter-tone feel.',
                category: 'exotic',
                mood: 'exotic'
            },
            'japanese': {
                pattern: [1, 4, 2, 1, 4],
                description: 'Traditional Japanese pentatonic scale.',
                category: 'exotic',
                mood: 'exotic'
            },
            'spanish': {
                pattern: [1, 3, 1, 2, 1, 2, 2],
                description: 'Phrygian dominant. Flamenco and Spanish music.',
                category: 'exotic',
                mood: 'exotic'
            },
            'gypsy': {
                pattern: [1, 3, 1, 2, 1, 3, 1],
                description: 'Romani music scale. Dramatic and passionate.',
                category: 'exotic',
                mood: 'exotic'
            },

            // Jazz Scales
            'bebop dominant': {
                pattern: [2, 2, 1, 2, 2, 1, 1, 1],
                description: 'Mixolydian with added major 7th. Jazz improvisation.',
                category: 'mode',
                mood: 'jazzy'
            },
            'whole tone': {
                pattern: [2, 2, 2, 2, 2, 2],
                description: 'Six-note scale of whole steps. Impressionistic, floating.',
                category: 'exotic',
                mood: 'mysterious'
            },
            'diminished': {
                pattern: [2, 1, 2, 1, 2, 1, 2, 1],
                description: 'Eight-note symmetrical scale. Jazz and classical.',
                category: 'exotic',
                mood: 'jazzy'
            }
        };

        // Chromatic notes
        const chromaticNotes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        // Generate scale notes from pattern
        function generateScaleNotes(root, pattern) {
            const rootIndex = chromaticNotes.indexOf(root);
            const notes = [root];
            let currentIndex = rootIndex;

            for (let i = 0; i < pattern.length - 1; i++) {
                currentIndex = (currentIndex + pattern[i]) % 12;
                notes.push(chromaticNotes[currentIndex]);
            }

            return notes;
        }

        // Get scale intervals as string
        function getScaleIntervals(pattern) {
            const intervalNames = {
                1: 'H', // Half step
                2: 'W', // Whole step
                3: 'W+H', // Whole + half
                4: 'WW' // Two whole steps
            };
            return pattern.map(interval => intervalNames[interval] || interval).join(' - ');
        }

        // Generate all scales for all roots
        function generateAllScales() {
            const allScales = {};

            chromaticNotes.forEach(root => {
                allScales[root] = {};

                Object.entries(scaleDatabase).forEach(([scaleName, scaleData]) => {
                    const notes = generateScaleNotes(root, scaleData.pattern);
                    allScales[root][scaleName] = {
                        ...scaleData,
                        notes: notes,
                        intervals: getScaleIntervals(scaleData.pattern)
                    };
                });
            });

            return allScales;
        }

        // Filter scales based on user selection
        function filterScales(allScales, filters) {
            const filtered = {};

            Object.entries(allScales).forEach(([root, scales]) => {
                if (filters.root !== 'all' && root !== filters.root) {
                    return;
                }

                const rootScales = {};
                Object.entries(scales).forEach(([scaleName, scaleData]) => {
                    let includeScale = true;

                    if (filters.scaleType !== 'all' && scaleData.category !== filters.scaleType) {
                        includeScale = false;
                    }

                    if (filters.mood !== 'all' && scaleData.mood !== filters.mood) {
                        includeScale = false;
                    }

                    if (includeScale) {
                        rootScales[scaleName] = scaleData;
                    }
                });

                if (Object.keys(rootScales).length > 0) {
                    filtered[root] = rootScales;
                }
            });

            return filtered;
        }

        // Calculate statistics
        function calculateStats(allScales) {
            let total = 0;
            const categories = {
                major: 0,
                minor: 0,
                mode: 0,
                pentatonic: 0,
                blues: 0,
                exotic: 0
            };

            Object.values(allScales).forEach(rootScales => {
                Object.values(rootScales).forEach(scale => {
                    total++;
                    if (categories.hasOwnProperty(scale.category)) {
                        categories[scale.category]++;
                    }
                });
            });

            return { total, ...categories };
        }

        // Guitar tuning (standard tuning) - Low to High E (bottom to top)
        const guitarTuning = ['E', 'A', 'D', 'G', 'B', 'E']; // Low E, A, D, G, B, High E
        let currentFretRange = { start: 0, end: 12 };
        let showNoteLabels = true;
        let selectedScale = null;

        // Get note at specific string and fret
        function getNoteAtFret(stringIndex, fret) {
            const openNote = guitarTuning[stringIndex];
            const openNoteIndex = chromaticNotes.indexOf(openNote);
            const noteIndex = (openNoteIndex + fret) % 12;
            return chromaticNotes[noteIndex];
        }

        // Generate fretboard HTML
        function generateFretboard(scaleNotes, rootNote) {
            const fretboard = document.getElementById('guitar-fretboard');
            const fretCount = currentFretRange.end - currentFretRange.start;
            const fretSpacing = 60; // pixels between frets

            // Calculate total width
            const totalWidth = fretCount * fretSpacing;
            fretboard.style.width = `${totalWidth + 60}px`;

            let html = `
                <div class="string-labels">
                    ${guitarTuning.slice().reverse().map(note => `<div class="string-label">${note}</div>`).join('')}
                </div>
                <div class="fretboard-strings-container">
            `;

            // Add guitar strings
            for (let i = 0; i < 6; i++) {
                html += `<div class="guitar-string"></div>`;
            }

            // Add fret wires
            if (currentFretRange.start === 0) {
                html += '<div class="fret-wire nut"></div>';
            }

            for (let fret = 1; fret <= fretCount; fret++) {
                const fretPosition = fret * fretSpacing - (currentFretRange.start * fretSpacing);
                html += `<div class="fret-wire" style="left: ${fretPosition}px;"></div>`;
            }

            // Add fret numbers
            html += '<div class="fret-numbers">';
            for (let fret = currentFretRange.start; fret <= currentFretRange.end; fret++) {
                if (fret === 0) continue; // Skip nut
                const fretPosition = (fret - currentFretRange.start) * fretSpacing + (fretSpacing / 2);
                html += `<div class="fret-number" style="left: ${fretPosition}px;">${fret}</div>`;
            }
            html += '</div>';

            // Add fret markers
            html += '<div class="fret-markers">';
            const markerFrets = [3, 5, 7, 9, 12, 15, 17, 19, 21, 24];
            const doubleMarkerFrets = [12, 24];

            for (let fret = currentFretRange.start; fret <= currentFretRange.end; fret++) {
                if (markerFrets.includes(fret)) {
                    const fretPosition = (fret - currentFretRange.start) * fretSpacing + (fretSpacing / 2);
                    const markerClass = doubleMarkerFrets.includes(fret) ? 'fret-marker double' : 'fret-marker';
                    html += `<div class="${markerClass}" style="left: ${fretPosition}px;"></div>`;
                }
            }
            html += '</div>';

            // Add note markers
            const stringPositions = [180, 148, 116, 84, 52, 20]; // Y positions: Low E(bottom), A, D, G, B, High E(top)

            guitarTuning.forEach((stringNote, stringIndex) => {
                for (let fret = currentFretRange.start; fret <= currentFretRange.end; fret++) {
                    const note = getNoteAtFret(stringIndex, fret);
                    const isInScale = scaleNotes.includes(note);
                    const isRoot = note === rootNote;

                    if (isInScale) {
                        let fretPosition;
                        if (fret === 0) {
                            fretPosition = 15; // Position on nut
                        } else {
                            fretPosition = (fret - currentFretRange.start) * fretSpacing + (fretSpacing / 2);
                        }

                        const cssClass = isRoot ? 'note-marker root-note clickable' : 'note-marker scale-note clickable';
                        const noteDisplay = isRoot ? 'R' : (showNoteLabels ? note : '●');

                        html += `<div class="${cssClass}"
                            style="left: ${fretPosition}px; top: ${stringPositions[stringIndex]}px;"
                            data-note="${note}" data-string="${stringIndex}" data-fret="${fret}"
                            onclick="playNote('${note}', ${stringIndex}, ${fret})"
                            title="Click to play ${note}">
                            ${noteDisplay}
                        </div>`;
                    }
                }
            });

            html += '</div>'; // Close fretboard-strings-container

            fretboard.innerHTML = html;
        }

        // Show fretboard for selected scale
        function showScaleFretboard(root, scaleName, scaleData) {
            selectedScale = { root, scaleName, scaleData };

            // Update display
            const display = document.getElementById('fretboard-display');
            const title = document.getElementById('fretboard-title');
            const subtitle = document.getElementById('fretboard-subtitle');

            title.textContent = `${root} ${scaleName}`;
            subtitle.textContent = `${scaleData.description} | Notes: ${scaleData.notes.join(' - ')}`;

            // Generate fretboard
            generateFretboard(scaleData.notes, root);

            // Show display
            display.classList.add('active');

            // Scroll to fretboard
            display.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Fretboard control functions
        window.setFretboardRange = function(start, end) {
            currentFretRange = { start, end };

            // Update button states
            document.querySelectorAll('.fretboard-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Regenerate fretboard if scale is selected
            if (selectedScale) {
                generateFretboard(selectedScale.scaleData.notes, selectedScale.root);
            }
        };

        window.toggleNoteLabels = function() {
            showNoteLabels = !showNoteLabels;

            // Update button state
            const btn = event.target;
            btn.textContent = showNoteLabels ? 'Hide Note Names' : 'Show Note Names';

            // Regenerate fretboard if scale is selected
            if (selectedScale) {
                generateFretboard(selectedScale.scaleData.notes, selectedScale.root);
            }
        };

        // Render scale card
        function renderScaleCard(root, scaleName, scaleData) {
            const fullScaleName = `${root} ${scaleName}`;
            const scaleId = `scale-${root}-${scaleName}`.replace(/[^a-zA-Z0-9]/g, '');

            return `
                <div class="scale-card" data-scale="${fullScaleName}" onclick="selectScale('${root}', '${scaleName}')">
                    <div class="scale-name">${fullScaleName}</div>
                    <div class="scale-info">
                        <div class="scale-notes">
                            ${scaleData.notes.map(note => `<span class="note">${note}</span>`).join('')}
                        </div>
                        <div class="scale-pattern">Pattern: ${scaleData.intervals}</div>
                        <div class="scale-description">${scaleData.description}</div>
                    </div>
                    <div class="scale-audio-controls">
                        <button class="play-scale-btn" onclick="playScale('${root}', '${scaleName}'); event.stopPropagation();">
                            ▶ Play Scale
                        </button>
                    </div>
                </div>
            `;
        }

        // Select scale function
        window.selectScale = function(root, scaleName) {
            // Remove previous selection
            document.querySelectorAll('.scale-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked card
            event.currentTarget.classList.add('selected');

            // Get scale data
            const allScales = generateAllScales();
            const scaleData = allScales[root][scaleName];

            // Store selected scale globally for playback
            window.selectedScale = {
                root: root,
                scaleName: scaleName,
                scaleData: scaleData
            };

            // Show fretboard
            showScaleFretboard(root, scaleName, scaleData);
        };

        // Render scale section
        function renderScaleSection(root, scales) {
            const scaleCards = Object.entries(scales)
                .sort(([a], [b]) => a.localeCompare(b))
                .map(([scaleName, scaleData]) => renderScaleCard(root, scaleName, scaleData))
                .join('');

            return `
                <div class="scale-section">
                    <h2 class="scale-section-title">
                        <span>🎵</span>
                        ${root} Scales (${Object.keys(scales).length})
                    </h2>
                    <div class="scale-grid">
                        ${scaleCards}
                    </div>
                </div>
            `;
        }

        // Play individual note function
        window.playNote = async function(note, stringIndex, fret) {
            if (typeof window.playGuitarNote === 'function') {
                // Add visual feedback
                const noteMarkers = document.querySelectorAll(`[data-note="${note}"][data-string="${stringIndex}"][data-fret="${fret}"]`);
                noteMarkers.forEach(marker => {
                    marker.classList.add('playing');
                    setTimeout(() => marker.classList.remove('playing'), 800);
                });

                // Play the note using guitar audio
                await window.playGuitarNote(note, 1.0);
            } else {
                console.log(`Playing note: ${note} (string ${stringIndex}, fret ${fret})`);
            }
        };

        // Play full scale with highlighting
        window.playScale = async function() {
            const scaleData = window.selectedScale;
            if (!scaleData) {
                alert('Please select a scale first');
                return;
            }

            const playButton = document.getElementById('play-scale-btn');
            playButton.disabled = true;
            playButton.textContent = '🔄 Playing...';

            try {
                // Get the scale notes in order
                const scaleNotes = scaleData.scaleData.notes;
                const rootNote = scaleData.root;

                // Play each note with a delay
                for (let i = 0; i < scaleNotes.length; i++) {
                    const note = scaleNotes[i];

                    // Highlight all instances of this note on the fretboard
                    const noteMarkers = document.querySelectorAll(`[data-note="${note}"]`);
                    noteMarkers.forEach(marker => marker.classList.add('playing'));

                    // Play the note
                    if (typeof window.playGuitarNote === 'function') {
                        await window.playGuitarNote(note, 0.8);
                    }

                    // Wait before next note
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // Remove highlighting
                    noteMarkers.forEach(marker => marker.classList.remove('playing'));
                }

                // Play the root note again to complete the scale
                const rootMarkers = document.querySelectorAll(`[data-note="${rootNote}"]`);
                rootMarkers.forEach(marker => marker.classList.add('playing'));

                if (typeof window.playGuitarNote === 'function') {
                    await window.playGuitarNote(rootNote, 1.0);
                }

                await new Promise(resolve => setTimeout(resolve, 500));
                rootMarkers.forEach(marker => marker.classList.remove('playing'));

            } catch (error) {
                console.error('Error playing scale:', error);
            } finally {
                playButton.disabled = false;
                playButton.textContent = '▶️ Play Scale';
            }
        };

        // Update display based on filters
        function updateDisplay() {
            const filters = {
                root: document.getElementById('root-filter').value,
                scaleType: document.getElementById('scale-type-filter').value,
                mood: document.getElementById('mood-filter').value
            };

            const allScales = generateAllScales();
            const filteredScales = filterScales(allScales, filters);
            const stats = calculateStats(allScales);

            // Update statistics
            document.getElementById('total-scales').textContent = stats.total;
            document.getElementById('major-scales').textContent = stats.major;
            document.getElementById('minor-scales').textContent = stats.minor;
            document.getElementById('modal-scales').textContent = stats.mode;
            document.getElementById('pentatonic-scales').textContent = stats.pentatonic + stats.blues;
            document.getElementById('exotic-scales').textContent = stats.exotic;

            // Render scales
            const container = document.getElementById('scales-container');
            container.innerHTML = '';

            if (Object.keys(filteredScales).length === 0) {
                container.innerHTML = '<div class="no-results">No scales match the selected filters.</div>';
                return;
            }

            // Render in chromatic order
            chromaticNotes.forEach(root => {
                if (filteredScales[root]) {
                    container.innerHTML += renderScaleSection(root, filteredScales[root]);
                }
            });
        }

        // Initialize page
        function init() {
            // Set up filter event listeners
            document.getElementById('root-filter').addEventListener('change', updateDisplay);
            document.getElementById('scale-type-filter').addEventListener('change', updateDisplay);
            document.getElementById('mood-filter').addEventListener('change', updateDisplay);

            // Initial display
            updateDisplay();
        }

        // Initialize when page loads
        init();
    </script>
</body>
</html>