<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Machine - Song Creation Guide</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/tonal@5.0.0/browser/tonal.min.js"></script>
    <script src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js"></script>
</head>
<body>
    <main class="app-container">
        <header class="app-header">
            <h1>Music Machine</h1>
            <p>Your guided journey from mood to complete song</p>
        </header>

        <div class="progress-bar">
            <div class="progress-step active" data-step="1">Mood</div>
            <div class="progress-step" data-step="2">Key & Tempo</div>
            <div class="progress-step" data-step="3">Chords</div>
            <div class="progress-step" data-step="4">Drums</div>
            <div class="progress-step" data-step="5">Bass</div>
            <div class="progress-step" data-step="6">Melody</div>
            <div class="progress-step" data-step="7">Lyrics</div>
            <div class="progress-step" data-step="8">Export</div>
        </div>

        <section id="step-mood" class="step-section active">
            <h2>Step 1: Choose Your Mood & Genre</h2>
            <p>Start your musical journey by selecting the mood and genre that inspire you.</p>

            <div class="top-navigation">
                <button id="mood-next-top" class="next-button" disabled>Next: Key & Tempo</button>
            </div>
            
            <div class="selection-group">
                <h3>Mood</h3>
                <div id="mood-options" class="option-grid"></div>
            </div>

            <div class="selection-group">
                <h3>Genre</h3>
                <div id="genre-options" class="option-grid"></div>
            </div>

            <button id="mood-next" class="next-button" disabled>Next: Key & Tempo</button>
        </section>

        <section id="step-key-tempo" class="step-section">
            <h2>Step 2: Key & Tempo</h2>
            <p>Based on your mood and genre, here are suggested musical foundations.</p>

            <div class="top-navigation">
                <button id="key-tempo-back-top" class="back-button">Back</button>
                <button id="key-tempo-next-top" class="next-button" disabled>Next: Chords</button>
            </div>
            
            <div class="selection-group">
                <h3>Musical Key</h3>
                <div id="key-options" class="option-grid"></div>
            </div>

            <div class="selection-group">
                <h3>Scale</h3>
                <div id="scale-options" class="option-grid"></div>
                <button id="scale-theory-btn" class="theory-toggle" onclick="showKeyScaleTheory()" style="display: none;">
                    ðŸŽ“ Learn Scale Theory
                </button>
            </div>

            <div class="selection-group">
                <h3>Tempo (BPM)</h3>
                <div id="tempo-options" class="option-grid"></div>
            </div>

            <div class="navigation">
                <button id="key-tempo-back" class="back-button">Back</button>
                <button id="key-tempo-next" class="next-button" disabled>Next: Chord Progression</button>
            </div>
        </section>

        <section id="step-chords" class="step-section">
            <h2>Step 3: Chord Progression</h2>
            <p>Choose a chord progression that fits your genre and key.</p>

            <div class="top-navigation">
                <button id="chords-back-top" class="back-button">Back</button>
                <button id="chords-next-top" class="next-button" disabled>Next: Drum Pattern</button>
            </div>
            
            <div id="chord-progressions" class="chord-grid"></div>
            <div id="chord-display" class="chord-display"></div>

            <div class="navigation">
                <button id="chords-back" class="back-button">Back</button>
                <button id="chords-next" class="next-button" disabled>Next: Drum Pattern</button>
            </div>
        </section>

        <section id="step-drums" class="step-section">
            <h2>Step 4: Drum Pattern</h2>
            <p>Select a rhythmic foundation for your song.</p>

            <div class="top-navigation">
                <button id="drums-back-top" class="back-button">Back</button>
                <button id="drums-next-top" class="next-button" disabled>Next: Bass Line</button>
            </div>
            
            <div id="drum-patterns" class="drum-grid"></div>
            <div id="drum-display" class="drum-display"></div>

            <div class="navigation">
                <button id="drums-back" class="back-button">Back</button>
                <button id="drums-next" class="next-button" disabled>Next: Bass Line</button>
            </div>
        </section>

        <section id="step-bass" class="step-section">
            <h2>Step 5: Bass Line</h2>
            <p>Create a bass line that follows your chord progression.</p>

            <div class="top-navigation">
                <button id="bass-back-top" class="back-button">Back</button>
                <button id="bass-next-top" class="next-button" disabled>Next: Melody Ideas</button>
            </div>
            
            <div id="bass-options" class="bass-grid"></div>
            <div id="bass-display" class="bass-display"></div>

            <div class="navigation">
                <button id="bass-back" class="back-button">Back</button>
                <button id="bass-next" class="next-button" disabled>Next: Melody Ideas</button>
            </div>
        </section>

        <section id="step-melody" class="step-section">
            <h2>Step 6: Melody Ideas</h2>
            <p>Explore melodic patterns that work with your chord progression.</p>

            <div class="top-navigation">
                <button id="melody-back-top" class="back-button">Back</button>
                <button id="melody-next-top" class="next-button" disabled>Next: Lyrics</button>
            </div>
            
            <div id="melody-suggestions" class="melody-grid"></div>
            <div id="melody-display" class="melody-display"></div>

            <div class="navigation">
                <button id="melody-back" class="back-button">Back</button>
                <button id="melody-next" class="next-button" disabled>Next: Lyrics</button>
            </div>
        </section>

        <section id="step-songcraft" class="step-section">
            <h2>Step 7: Lyrics & Structure</h2>
            <p>Create your complete song structure with chord progressions and lyrics in one place.</p>

            <div class="top-navigation">
                <button id="songcraft-back-top" class="back-button">Back</button>
                <button id="songcraft-next-top" class="next-button" disabled>Next: Export & Summary</button>
            </div>

            <div class="songcraft-workspace">
                <!-- Structure Templates -->
                <div class="structure-templates">
                    <h3>Song Templates</h3>
                    <div class="template-grid">
                        <div class="template-card" data-template="verse-chorus">
                            <h4>Verse-Chorus</h4>
                            <p>Verse â†’ Chorus â†’ Verse â†’ Chorus â†’ Bridge â†’ Chorus</p>
                        </div>
                        <div class="template-card" data-template="aaba">
                            <h4>AABA</h4>
                            <p>Verse â†’ Verse â†’ Bridge â†’ Verse</p>
                        </div>
                        <div class="template-card" data-template="pop">
                            <h4>Pop Structure</h4>
                            <p>Intro â†’ Verse â†’ Pre-Chorus â†’ Chorus â†’ Verse â†’ Pre-Chorus â†’ Chorus â†’ Bridge â†’ Chorus â†’ Outro</p>
                        </div>
                        <div class="template-card" data-template="custom">
                            <h4>Custom</h4>
                            <p>Build your own structure</p>
                        </div>
                    </div>
                </div>

                <!-- Song Builder -->
                <div class="song-builder">
                    <div class="builder-header">
                        <h3>Song Structure</h3>
                        <div class="builder-controls">
                            <button id="add-section" class="add-section-btn">+ Add Section</button>
                            <button id="clear-structure" class="clear-btn">Clear All</button>
                        </div>
                    </div>

                    <div id="song-sections" class="song-sections">
                        <!-- Dynamic sections will be added here -->
                    </div>
                </div>

                <!-- Lyrics Helper -->
                <div class="lyrics-helper">
                    <h3>Thematic Words</h3>
                    <div id="thematic-words" class="word-suggestions"></div>
                    <button id="generate-words" class="generate-button">Generate Words</button>
                </div>
            </div>

            <div class="navigation">
                <button id="songcraft-back" class="back-button">Back</button>
                <button id="songcraft-next" class="next-button" disabled>Next: Export & Summary</button>
            </div>
        </section>

        <section id="step-export" class="step-section">
            <h2>Step 8: Export & Summary</h2>
            <p>Your complete song plan is ready! Review and export your creation.</p>
            
            <div id="song-summary" class="song-summary"></div>
            
            <div class="export-options">
                <button id="export-text" class="export-button">Export as Text</button>
                <button id="export-json" class="export-button">Export as JSON</button>
                <button id="export-midi" class="export-button">Export MIDI Files</button>
                <button id="export-ableton" class="export-button">Download Ableton Template</button>
                <button id="start-over" class="start-over-button">Start New Song</button>
            </div>
            
            <div id="midi-export-options" class="midi-export-panel" style="display: none;">
                <h3>MIDI Export Options</h3>
                <div class="track-options">
                    <label><input type="checkbox" id="export-chords" checked> Chord Progression</label>
                    <label><input type="checkbox" id="export-bass" checked> Bass Line</label>
                    <label><input type="checkbox" id="export-melody" checked> Melody</label>
                    <label><input type="checkbox" id="export-drums" checked> Drum Pattern</label>
                    <label><input type="checkbox" id="export-harmony" checked> Harmony Parts</label>
                    <label><input type="checkbox" id="export-pads" checked> Background Pads</label>
                </div>
                <div class="arrangement-options">
                    <h4>Arrangement Settings</h4>
                    <label>Song Length: <select id="song-length">
                        <option value="short">Short (2-3 minutes)</option>
                        <option value="medium" selected>Medium (3-4 minutes)</option>
                        <option value="long">Long (4-5 minutes)</option>
                    </select></label>
                    <label>Variations: <select id="midi-variations">
                        <option value="1">Single version</option>
                        <option value="2" selected>2 variations per track</option>
                        <option value="3">3 variations per track</option>
                    </select></label>
                </div>
                <button id="generate-midi" class="export-button">Generate MIDI Files</button>
            </div>

            <div class="navigation">
                <button id="export-back" class="back-button">Back</button>
            </div>
        </section>
    </main>

    <script type="module" src="js/audio-engine.js"></script>
    <script type="module" src="js/midi-generator.js"></script>
    <script type="module" src="js/chord-diagrams.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>